# Copyright 2023 Google LLC
#
# Use of this source code is governed by a BSD-style
# license that can be found in the LICENSE file or at
# https://developers.google.com/open-source/licenses/bsd

termid=$1
logfile=`find "$WERMVARDIR" -path '*/hist' -prune -o -name $termid -print \
| sort -r \
| head -n 1`
shift

# Dump log. Makes a script generated by `script` readable and grep'able
dl () {
	cat $logfile
}

# rflt: Reverse filter. Shows the logfile with lines in reverse order, passing
# arguments directly to sed. Can use to progressively filter grep results. This
# would print the log starting from the grep invocation, and omitting all lines
# that mention tests:
# rflt '/$ grep/q; /[tT]est/d'
rflt () {
	tac $logfile | sed "$@" | $PAGER
}

# Same as rflt but uses `more` instead of $PAGER.
rfmt () {
	tac $logfile | sed "$@" | more
}

# Similar to rfmt and rflt but uses no pager at all
rft () {
	tac $logfile | sed "$@"
}

dltf () {
	tail -f $logfile
}

# grep log
gl () {
	grep "$@" $logfile
}

# browse (less) log
lel () {
	less "$@" $logfile
}

# browse binary (xxd | less) log
xll () {
	xxd $logfile | less
}

lel +G
