#!/bin/sh

cat <<EOF
Content-type: text/html


<!DOCTYPE html>
<meta charset='utf-8'/>
<html>
<head>
	<title>Attach</title>
</head>
<body style="font-family: monospace">
<big>Common</big>
<ul>
<li><a href="http://localhost:8090/?termid=grunt-arc-r-sdk&pream=cd%20/s/cros2%0dexec%20chromite/bin/cros_sdk%20BOARD=grunt-arc-r%20USE='chrome_internal%20-cros-debug%20compilation_database'%0d">grunt-arc-r-sdk</a>
EOF

termno=1
for dir in /s/chrom /s/cros2/src /s/master-arc-dev gum/c/lib werm; do
	for i in `seq 5`; do
		termid=cd_$termno
		printf '
		<li><a href="/?termid=%s&pream=exec%%20ow%%20%s%%0d">
		%s (%d)</a href>
		' $termid $dir $dir $i
		termno=$(( termno + 1 ))
	done
done

cat <<EOF

<li><a href="/?termid=novnc&pream=exec /usr/share/novnc/utils/launch.sh%0d">novnc</a>
</ul>
<big>Active sessions</big>
<table>
EOF

ls /tmp/dtach.* | sed 's/^.*[.]//' |
while read sess
do
	printf '<tr>
		<td style="padding-right:20pt">[<strong>%s</strong>]
		<td><a href="/?termid=%s">%s</a>
		</tr>\n' \
		$sess \
		$sess \
		"`cat /tmp/title.$sess`"
done

cat <<EOF
</table>
</body>
EOF
